# 交易模式说明

**策略**: velocityfollow  
**分析时间**: 2025-12-26

---

## 🎯 交易模式：**对冲锁利 + 止盈赚利润（混合模式）**

当前策略采用**混合交易模式**，优先对冲锁利，如果对冲单未成交则通过止盈赚取利润。

---

## 📋 交易流程

### 1. 开仓阶段（Entry + Hedge）

#### Entry订单（主单）
- **订单类型**: FAK（Fill or Kill）
- **执行方式**: 立即成交（Taker）
- **方向**: 买入速度更快的一侧（UP 或 DOWN）
- **价格**: 使用订单簿实际 ask 价格
- **目的**: 快速捕捉价格动量

#### Hedge订单（对冲单）
- **订单类型**: GTC（Good Till Cancel）
- **执行方式**: 限价挂单（Maker）
- **方向**: 买入对侧（UP 的对侧是 DOWN，反之亦然）
- **价格**: 互补挂单价格 = `100 - entryAskCents - hedgeOffsetCents`
- **目的**: 对冲风险，锁定利润

#### 价格计算示例

假设 Entry 订单以 69c 成交：
- Entry价格: 69c
- HedgeOffset: 4c（配置值）
- Hedge价格: 100 - 69 - 4 = **27c**
- **总成本**: 69c + 27c = **96c**
- **锁定利润**: 100c - 96c = **4c**

---

## 💰 盈利模式

### 模式A：对冲锁利（理想情况）

**场景**: Entry 和 Hedge 订单都成交

**盈利计算**:
- Entry成本: 69c
- Hedge成本: 27c
- 总成本: 96c
- **锁定利润**: 4c（100c - 96c）

**特点**:
- ✅ 风险低：无论市场如何波动，都锁定4c利润
- ✅ 稳定：不依赖价格方向
- ✅ 快速：Hedge订单成交后即可平仓

**实际案例**（从日志分析）:
```
交易 #1: Entry @ 69c, Hedge @ 27c → 总成本 96c，锁定利润 4c
交易 #2: Entry @ 70c, Hedge @ 26c → 总成本 96c，锁定利润 4c
交易 #3: Entry @ 72c, Hedge @ 24c → 总成本 96c，锁定利润 4c
```

### 模式B：止盈赚利润（Hedge未成交时）

**场景**: Entry 订单成交，但 Hedge 订单未成交（挂单中）

**盈利方式**: 通过止盈/止损机制平仓

**止盈配置**:
```yaml
takeProfitCents: 2          # 止盈：当前 bid - 入场均价 >= 2c 则卖出
stopLossCents: 5            # 止损：入场均价 - 当前 bid >= 5c 则卖出
maxHoldSeconds: 75          # 时间止损：持仓超过 75 秒强制平仓
```

**分批止盈**:
```yaml
partialTakeProfits:
  - profitCents: 2           # 利润达到2c时，卖出50%持仓
    fraction: 0.5
  - profitCents: 4           # 利润达到4c时，再卖出50%持仓
    fraction: 0.5
```

**追踪止盈**:
```yaml
enableTrailingTakeProfit: true
trailStartCents: 3          # 达到3c利润后开始追踪
trailDistanceCents: 2       # 回撤2c触发平仓
```

**特点**:
- ⚠️ 风险较高：依赖价格方向
- 📈 潜在利润更大：如果价格继续上涨，利润可能超过4c
- ⏱️ 需要等待：等待价格达到止盈条件

**实际案例**（从日志分析）:
```
交易 #1: Entry @ 69c 成交，Hedge @ 27c 挂单中
→ 如果价格涨到 71c，触发止盈（利润 2c）
→ 如果价格跌到 64c，触发止损（亏损 5c）
```

---

## 🔄 订单执行模式

### Sequential（顺序模式）- 当前配置

```yaml
orderExecutionMode: "sequential"
```

**执行流程**:
1. 先下 Entry 订单（FAK）
2. 等待 Entry 订单成交
3. Entry 成交后，下 Hedge 订单（GTC）

**优势**:
- ✅ 风险低：确保 Entry 成交后再下 Hedge
- ✅ 避免未对冲风险：如果 Entry 失败，不会下 Hedge

**劣势**:
- ⏱️ 速度慢：需要等待 Entry 成交（~200-500ms）

### Parallel（并发模式）- 可选配置

```yaml
orderExecutionMode: "parallel"
```

**执行流程**:
1. 同时提交 Entry 和 Hedge 订单

**优势**:
- ⚡ 速度快：减少下单延迟（~100-200ms）

**劣势**:
- ⚠️ 风险高：如果 Entry 失败，Hedge 可能已提交（需要自动取消）

---

## 📊 当前配置总结

### 对冲锁利配置

```yaml
hedgeOffsetCents: 4          # 对冲单价格偏移：4c
orderSize: 11                # Entry订单大小：11 USDC
hedgeOrderSize: 0           # Hedge订单大小：0=跟随orderSize
```

**锁定利润**: 每笔交易锁定 **4c** 利润（如果对冲成功）

### 止盈止损配置

```yaml
takeProfitCents: 2          # 止盈：2c
stopLossCents: 5            # 止损：5c
maxHoldSeconds: 75           # 时间止损：75秒
```

**分批止盈**:
- 利润达到 2c：卖出 50% 持仓
- 利润达到 4c：再卖出 50% 持仓

**追踪止盈**:
- 达到 3c 利润后开始追踪
- 回撤 2c 触发平仓

---

## 🎯 策略目标

### 主要目标：对冲锁利

1. **优先对冲**: 通过 Entry + Hedge 组合，锁定 4c 利润
2. **风险控制**: 总成本控制在 96c 以内（100c - 4c）
3. **稳定盈利**: 不依赖价格方向，只要对冲成功就有利润

### 次要目标：止盈赚利润

1. **Hedge未成交时**: 通过止盈/止损机制平仓
2. **潜在利润更大**: 如果价格继续上涨，利润可能超过 4c
3. **风险控制**: 通过止损和时间止损控制风险

---

## 💡 实际交易分析

### 从最新日志看交易模式

**交易 #1** (15:31:14):
- Entry: BUY @ 0.6900, size=11.0, **status=filled** ✅
- Hedge: BUY @ 0.2700, size=11.0, **status=open** ⏳
- **模式**: Entry已成交，Hedge挂单中 → **模式B（止盈赚利润）**

**交易 #2** (15:31:16):
- Entry: BUY @ 0.7000, size=10.9714, **status=filled** ✅
- Hedge: BUY @ 0.2600, size=11.0, **status=open** ⏳
- **模式**: Entry已成交，Hedge挂单中 → **模式B（止盈赚利润）**

**交易 #3** (15:31:18):
- Entry: BUY @ 0.7200, size=11.0, **status=filled** ✅
- Hedge: BUY @ 0.2400, size=10.9583, **status=open** ⏳
- **模式**: Entry已成交，Hedge挂单中 → **模式B（止盈赚利润）**

**平仓记录** (15:31:15):
- SELL @ 0.6800, size=11.0, status=filled ✅
- SELL @ 0.3000, size=11.0, status=filled ✅
- **说明**: 第一笔交易在1秒后平仓，可能是触发了止盈/止损

---

## 🔍 关键发现

### 当前实际运行模式

1. **Entry订单**: 全部立即成交（FAK订单特性）
2. **Hedge订单**: 大部分挂单中（GTC限价单）
3. **实际模式**: **主要是模式B（止盈赚利润）**

### 为什么Hedge订单未成交？

1. **价格设置**: Hedge价格是互补挂单价（27c），可能低于当前市场价格
2. **限价单特性**: GTC限价单需要价格回落到挂单价才能成交
3. **市场波动**: 如果价格继续上涨，Hedge订单可能不会成交

### 策略优化建议

1. **如果希望更多对冲锁利**:
   - 可以调整 `hedgeOffsetCents`，降低Hedge价格，提高成交概率
   - 但会减少锁定利润（例如从4c降到3c）

2. **如果希望更多止盈赚利润**:
   - 当前配置已经很好，止盈/止损机制完善
   - 可以考虑调整 `takeProfitCents` 和 `stopLossCents`

---

## 📝 总结

### 交易模式

**当前策略是混合模式**：
- **优先目标**: 对冲锁利（Entry + Hedge 都成交，锁定4c利润）
- **实际运行**: 主要是止盈赚利润（Entry成交，Hedge挂单，通过止盈/止损平仓）

### 盈利来源

1. **对冲锁利**: 如果Entry和Hedge都成交，锁定4c利润
2. **止盈赚利润**: 如果Hedge未成交，通过止盈机制赚取利润（可能超过4c）

### 风险控制

1. **止损**: 5c止损，控制最大亏损
2. **时间止损**: 75秒强制平仓，避免长期持仓
3. **分批止盈**: 逐步平仓，锁定部分利润
4. **追踪止盈**: 防止利润回吐

---

**报告生成时间**: 2025-12-26  
**策略版本**: velocityfollow

