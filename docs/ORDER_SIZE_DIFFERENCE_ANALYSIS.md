# è®¢å•æ•°é‡å·®å¼‚åˆ†æ

## ğŸ“‹ é—®é¢˜æè¿°

æ ¹æ® UI æˆªå›¾ï¼Œå®é™…æŒä»“æ•°é‡ä¸ä¸€è‡´ï¼š
- **UP**: 11.25 shares @ 63Â¢
- **DOWN**: 11.00 shares @ 37Â¢
- **å·®å¼‚**: 0.25 shares

## ğŸ” åŸå› åˆ†æ

### 1. FAK è®¢å•å…è®¸éƒ¨åˆ†æˆäº¤

**Entry è®¢å•ç±»å‹**: `OrderTypeFAK` (Fill-And-Kill)

**FAK è®¢å•ç‰¹ç‚¹**:
- âœ… **å…è®¸éƒ¨åˆ†æˆäº¤**ï¼ˆä¸ FOK çš„ä¸»è¦åŒºåˆ«ï¼‰
- âœ… å°½å¯èƒ½æˆäº¤ï¼Œå‰©ä½™éƒ¨åˆ†è‡ªåŠ¨å–æ¶ˆ
- âœ… å§‹ç»ˆæ˜¯ TAKERï¼ˆä¸ä¼šæˆä¸º maker ç•™åœ¨è®¢å•ç°¿ï¼‰

**å¯èƒ½æƒ…å†µ**:
- Entry è®¢å•ï¼ˆFAKï¼‰ä¸‹å• 11 shares
- ç”±äºå¸‚åœºæµåŠ¨æ€§ï¼Œå®é™…æˆäº¤äº† **11.25 shares**ï¼ˆéƒ¨åˆ†æˆäº¤ï¼‰
- æˆ–è€…æœ‰å¤šä¸ª Entry è®¢å•ï¼Œç´¯è®¡æˆäº¤ 11.25 shares

### 2. å¤šä¸ª Entry è®¢å•ç´¯è®¡

ä»ä¹‹å‰çš„åˆ†æï¼Œç³»ç»Ÿä¸‹äº†å¤šä¸ª Entry è®¢å•ï¼š
- è®¢å•1: `0xa3fd8459...` - 11 shares âœ… filled
- è®¢å•2: `0xe1e09c00...` - 11 shares âŒ failed
- è®¢å•3: `0xc32a5dc6...` - 11 shares âŒ canceled

**å¯èƒ½æƒ…å†µ**:
- è®¢å•1 æˆäº¤äº† 11 shares
- ä½†å¯èƒ½æœ‰å…¶ä»–è®¢å•éƒ¨åˆ†æˆäº¤ï¼Œç´¯è®¡åˆ° 11.25 shares
- æˆ–è€…è®¢å•1 æœ¬èº«éƒ¨åˆ†æˆäº¤äº† 11.25 shares

### 3. ä»·æ ¼å˜åŒ–å¯¼è‡´æ•°é‡è°ƒæ•´

**ä¸‹å•æ—¶**:
- Entry: 11 shares @ 64Â¢
- Hedge: 11 shares @ 33Â¢

**å®é™…æˆäº¤æ—¶**:
- Entry: å¯èƒ½å› ä¸ºä»·æ ¼å˜åŒ–ï¼Œå®é™…æˆäº¤ 11.25 shares
- Hedge: 11 shares @ 33Â¢ (GTC é™ä»·å•ï¼Œå…¨éƒ¨æˆäº¤)

### 4. æœ€å°é‡‘é¢è°ƒæ•´

è™½ç„¶æˆ‘ä»¬ç¡®ä¿äº†æ•°é‡ç›¸ç­‰ï¼Œä½†åœ¨å®é™…æ‰§è¡Œæ—¶ï¼š
- Entry è®¢å•ï¼ˆFAKï¼‰å¯èƒ½å› ä¸ºä»·æ ¼å˜åŒ–ï¼Œéœ€è¦è°ƒæ•´æ•°é‡ä»¥æ»¡è¶³æœ€å°é‡‘é¢
- å¦‚æœä»·æ ¼ä» 64Â¢ é™åˆ° 63Â¢ï¼Œå¯èƒ½éœ€è¦æ›´å¤š shares æ¥æ»¡è¶³ $1.1 çš„æœ€å°é‡‘é¢

## ğŸ’¡ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: ä½¿ç”¨ FOK è®¢å•ï¼ˆå…¨éƒ¨æˆäº¤æˆ–å–æ¶ˆï¼‰

**é—®é¢˜**: FOK è®¢å•è¦æ±‚å…¨éƒ¨æˆäº¤ï¼Œå¦‚æœæµåŠ¨æ€§ä¸è¶³ä¼šå®Œå…¨å¤±è´¥ã€‚

**ä¸å»ºè®®**: å› ä¸ºå¸‚åœºæµåŠ¨æ€§ä¸ç¡®å®šï¼ŒFOK è®¢å•å®¹æ˜“å¤±è´¥ã€‚

### æ–¹æ¡ˆ 2: æ ¹æ®å®é™…æˆäº¤æ•°é‡è°ƒæ•´ Hedge è®¢å•

**æ€è·¯**: å½“ Entry è®¢å•æˆäº¤åï¼Œæ ¹æ®å®é™…æˆäº¤æ•°é‡è°ƒæ•´ Hedge è®¢å•ã€‚

**å®ç°**:
```go
// åœ¨è®¢å•æ›´æ–°å›è°ƒä¸­
func (s *Strategy) OnOrderUpdate(ctx context.Context, order *domain.Order) error {
    if order.IsEntryOrder && order.Status == domain.OrderStatusFilled {
        // Entry è®¢å•å·²æˆäº¤ï¼Œè°ƒæ•´ Hedge è®¢å•æ•°é‡
        if order.HedgeOrderID != nil {
            hedgeOrder := s.getOrder(*order.HedgeOrderID)
            if hedgeOrder != nil && hedgeOrder.Status == domain.OrderStatusOpen {
                // è°ƒæ•´ Hedge è®¢å•æ•°é‡ï¼Œä½¿å…¶ä¸ Entry è®¢å•ç›¸ç­‰
                newSize := order.FilledSize
                // å–æ¶ˆæ—§è®¢å•ï¼Œä¸‹æ–°è®¢å•
                _ = s.TradingService.CancelOrder(ctx, *order.HedgeOrderID)
                // ä¸‹æ–°çš„ Hedge è®¢å•ï¼Œæ•°é‡ = Entry å®é™…æˆäº¤æ•°é‡
                // ...
            }
        }
    }
    return nil
}
```

### æ–¹æ¡ˆ 3: ä½¿ç”¨ GTC è®¢å•å¹¶æ‰‹åŠ¨è°ƒæ•´

**æ€è·¯**: Entry è®¢å•ä¹Ÿä½¿ç”¨ GTCï¼Œç„¶åæ ¹æ®å®é™…æˆäº¤æƒ…å†µæ‰‹åŠ¨è°ƒæ•´ã€‚

**é—®é¢˜**: GTC è®¢å•å¯èƒ½ä¸ä¼šç«‹å³æˆäº¤ï¼Œä¸ç¬¦åˆç­–ç•¥çš„"å¿«é€Ÿåƒå•"éœ€æ±‚ã€‚

### æ–¹æ¡ˆ 4: æ¥å—éƒ¨åˆ†å·®å¼‚ï¼ˆæ¨èï¼‰

**æ€è·¯**: æ¥å— FAK è®¢å•çš„éƒ¨åˆ†æˆäº¤å·®å¼‚ï¼Œè¿™æ˜¯æ­£å¸¸çš„å¸‚åœºè¡Œä¸ºã€‚

**ç†ç”±**:
- FAK è®¢å•å…è®¸éƒ¨åˆ†æˆäº¤æ˜¯æ­£å¸¸è¡Œä¸º
- 0.25 shares çš„å·®å¼‚å¾ˆå°ï¼ˆçº¦ 2.3%ï¼‰
- ä¸å½±å“æ•´ä½“ç­–ç•¥é€»è¾‘

**å»ºè®®**: 
- åœ¨æ—¥å¿—ä¸­è®°å½•å®é™…æˆäº¤æ•°é‡
- å¦‚æœå·®å¼‚è¾ƒå¤§ï¼ˆ> 5%ï¼‰ï¼Œå¯ä»¥è€ƒè™‘è°ƒæ•´ Hedge è®¢å•

## ğŸ“Š å½“å‰æƒ…å†µåˆ†æ

### å®é™…æŒä»“

| æ–¹å‘ | æ•°é‡ | å‡ä»· | æˆæœ¬ | å½“å‰ä»·å€¼ | æ”¶ç›Š |
|------|------|------|------|---------|------|
| **UP** | 11.25 shares | 63Â¢ | $7.04 | $5.57 | -$1.47 (-20.87%) |
| **DOWN** | 11.00 shares | 37Â¢ | $4.07 | $5.55 | +$1.48 (+36.48%) |

### å·®å¼‚åˆ†æ

- **æ•°é‡å·®å¼‚**: 0.25 shares (2.3%)
- **æˆæœ¬å·®å¼‚**: $7.04 vs $4.07
- **æ”¶ç›Š**: UP äºæŸï¼ŒDOWN ç›ˆåˆ©ï¼Œæ•´ä½“ç›ˆåˆ© $0.01

### å½±å“è¯„ä¼°

**è½»å¾®å½±å“**:
- æ•°é‡å·®å¼‚å¾ˆå°ï¼ˆ0.25 sharesï¼Œçº¦ 2.3%ï¼‰
- ä¸å½±å“æ•´ä½“ç­–ç•¥é€»è¾‘
- æ˜¯ FAK è®¢å•çš„æ­£å¸¸è¡Œä¸º

## ğŸ¯ å»ºè®®

### çŸ­æœŸæ–¹æ¡ˆï¼ˆæ¨èï¼‰

1. **æ¥å—å·®å¼‚**: 0.25 shares çš„å·®å¼‚æ˜¯æ­£å¸¸çš„ï¼Œä¸å½±å“ç­–ç•¥
2. **æ·»åŠ æ—¥å¿—**: è®°å½•å®é™…æˆäº¤æ•°é‡ï¼Œæ–¹ä¾¿ç›‘æ§
3. **ç›‘æ§å·®å¼‚**: å¦‚æœå·®å¼‚æŒç»­è¾ƒå¤§ï¼ˆ> 5%ï¼‰ï¼Œå†è€ƒè™‘è°ƒæ•´

### é•¿æœŸæ–¹æ¡ˆ

1. **å®ç°è®¢å•æ›´æ–°å›è°ƒ**: å½“ Entry è®¢å•æˆäº¤åï¼Œæ ¹æ®å®é™…æˆäº¤æ•°é‡è°ƒæ•´ Hedge è®¢å•
2. **æ·»åŠ å·®å¼‚ç›‘æ§**: å¦‚æœå·®å¼‚è¶…è¿‡é˜ˆå€¼ï¼Œè‡ªåŠ¨è°ƒæ•´ Hedge è®¢å•
3. **ä¼˜åŒ–ä¸‹å•é€»è¾‘**: è€ƒè™‘ä½¿ç”¨ IOC è®¢å•æˆ–å…¶ä»–è®¢å•ç±»å‹

## ğŸ“ ä»£ç ä¿®æ”¹å»ºè®®

### æ·»åŠ æ—¥å¿—è®°å½•å®é™…æˆäº¤æ•°é‡

```go
// åœ¨è®¢å•æ›´æ–°å›è°ƒä¸­
func (s *Strategy) OnOrderUpdate(ctx context.Context, order *domain.Order) error {
    if order.IsEntryOrder && order.Status == domain.OrderStatusFilled {
        log.Infof("ğŸ“Š [%s] Entry è®¢å•æˆäº¤: orderID=%s filledSize=%.4f shares (åŸå§‹æ•°é‡=%.4f)", 
            ID, order.OrderID, order.FilledSize, order.Size)
        
        // æ£€æŸ¥ Hedge è®¢å•
        if order.HedgeOrderID != nil {
            hedgeOrder := s.getOrder(*order.HedgeOrderID)
            if hedgeOrder != nil {
                diff := math.Abs(order.FilledSize - hedgeOrder.FilledSize)
                if diff > 0.1 { // å·®å¼‚è¶…è¿‡ 0.1 shares
                    log.Warnf("âš ï¸ [%s] Entry å’Œ Hedge æ•°é‡ä¸ä¸€è‡´: Entry=%.4f, Hedge=%.4f, å·®å¼‚=%.4f", 
                        ID, order.FilledSize, hedgeOrder.FilledSize, diff)
                }
            }
        }
    }
    return nil
}
```

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-12-25  
**é—®é¢˜**: Entry å’Œ Hedge è®¢å•æ•°é‡ä¸ä¸€è‡´ï¼ˆ11.25 vs 11.00ï¼‰  
**åŸå› **: FAK è®¢å•å…è®¸éƒ¨åˆ†æˆäº¤ï¼Œå¯¼è‡´å®é™…æˆäº¤æ•°é‡å¯èƒ½ä¸åŒ  
**å»ºè®®**: æ¥å—å°å·®å¼‚ï¼Œæˆ–å®ç°è®¢å•æ›´æ–°å›è°ƒè‡ªåŠ¨è°ƒæ•´

