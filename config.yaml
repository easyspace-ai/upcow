# config.yaml（40 USDC 版本，velocityfollow + 质量过滤 + 分批/追踪止盈）
proxy:
  host: "127.0.0.1"
  port: 15236
 
market:
  symbol: "btc"
  timeframe: "15m"
  kind: "updown"
  slugTemplates:
    "15m": "{symbol}-{kind}-{timeframe}-{timestamp}"
    "1h": "{coinName}-up-or-down-{month}-{day}-{hour}{ampm}-et"
    "4h": "{symbol}-{kind}-{timeframe}-{timestamp}"
  # 市场精度配置（系统级配置，从订单簿获取后写入）
  precision:
    tick_size: "0.001"      # 价格精度：0.1 / 0.01 / 0.001 / 0.0001
    min_order_size: "5"     # 最小订单大小
    neg_risk: false          # 是否为负风险市场
 
exchangeStrategies:
  - on: polymarket
    velocityfollow:
      # ====== 订单参数 ======
      orderSize: 11                 # 订单大小（USDC）：小单降低滑点，适合40u高频交易
      hedgeOrderSize: 0              # 对冲单大小（USDC）：0=跟随 orderSize
    
      # ====== 速度触发参数 ======
      # 更高频触发（调整以适应价格缓慢上涨：50c→99c是15分钟过程）
      windowSeconds: 8              # 时间窗口（秒）：从4秒增加到8秒，给价格更多时间积累变化
      minMoveCents: 1                # 最小价格变化（分）：从2c降低到1c，更容易触发
      minVelocityCentsPerSec: 0.15   # 最小速度（分/秒）：从0.45降低到0.15，适应缓慢上涨（平均速度0.054c/s）
      
      # ====== 交易频率控制 ======
      cooldownMs: 1400              # 触发冷却时间（毫秒）：两次触发之间至少间隔1.4秒
      maxTradesPerCycle: 3           # 每周期最多交易次数（0=不设限，建议1-3）
      warmupMs: 400                  # 周期切换后预热时间（毫秒）：避免周期切换瞬间误触发
    
      # ====== 价格和滑点保护 ======
      maxSpreadCents: 4              # 最大价差（分）：避免极差盘口误触发（建议不要放宽）
      minEntryPriceCents: 55        # Entry 价格下限（分）：避免低价时 size 被放大
      maxEntryPriceCents: 75        # Entry 价格上限（分）：避免 99/100 假盘口
      hedgeOffsetCents: 4            # 对冲单价格偏移（分）：对侧挂单价 = (100 - entryAskCents - offset)
      
      # ====== 市场质量门控（提升胜率） ======
      # 提高频率靠"更短 age + 仍然要求干净盘口"
      enableMarketQualityGate: true
      marketQualityMinScore: 30              # 最小质量分数（0-100）：降低到30，允许35分的市场条件通过
      marketQualityMaxSpreadCents: 8         # 最大价差（分）：放宽价差限制（从4c调整到6c），减少 wide_spread 扣分
      marketQualityMaxBookAgeMs: 3000        # WebSocket数据最大年龄（毫秒）：放宽限制（从1.8秒调整到3秒），减少 ws_stale 扣分
    
      # ====== 价格优先选择 ======
      # 当 UP/DOWN 都满足速度条件时，优先选择价格更高的一边（胜率更稳）
      preferHigherPrice: true
      minPreferredPriceCents: 55            # 优先价格阈值（分）：与 minEntryPriceCents 对齐，确保价格选择逻辑一致
    
      # ====== 订单执行模式 ======
      # sequential: 顺序下单（先下 Entry，成交后再下 Hedge）- 风险低，速度慢（~200-500ms）
      # parallel: 并发下单（同时提交 Entry 和 Hedge）- 速度快（~100-200ms），风险高
      orderExecutionMode: "sequential"        # "sequential" 或 "parallel"，默认 "sequential"
      sequentialCheckIntervalMs: 20          # 顺序模式：检查订单状态的间隔（毫秒）
      sequentialMaxWaitMs: 1200             # 顺序模式：最大等待时间（毫秒），FAK 订单通常立即成交
    
      # ====== 周期保护 ======
      cycleEndProtectionMinutes: 3           # 周期结束前保护时间（分钟）：在周期结束前N分钟不开新单，降低风险
    
      # ====== 对冲单管理 ======
      hedgeReorderTimeoutSeconds: 15        # 对冲单重下超时（秒）：主单成交后，如果对冲单在指定时间内未成交，重新下单
    
      # ====== 出场（平仓）参数 ======
      # 当持仓存在时，策略会优先处理出场，不再叠加开仓
      # 触发价使用 bestBid（SELL FAK），因此实际成交价会略受盘口影响
      takeProfitCents: 2                     # 止盈（分）：当前 bid - 入场均价 >= 2c 则卖出平仓（0=禁用）
      stopLossCents: 5                       # 止损（分）：入场均价 - 当前 bid >= 5c 则卖出平仓（0=禁用）
      maxHoldSeconds: 75                     # 时间止损（秒）：持仓超过 75 秒强制平仓（0=禁用）
      exitCooldownMs: 900                    # 出场冷却（毫秒）：避免频繁重复下卖单
      exitBothSidesIfHedged: true            # 若同周期同时持有 UP/DOWN，则同时卖出全平（更简单、更安全）
    
      # ====== 分批止盈（提升盈亏比） ======
      # 达到利润阈值后，卖出"当前剩余持仓"的 fraction 比例（每个 level 只触发一次）
      partialTakeProfits:
        - profitCents: 2                     # 利润阈值（分）
          fraction: 0.5                      # 卖出比例（0-1）
        - profitCents: 4                     # 利润阈值（分）
          fraction: 0.5                      # 卖出比例（0-1）
    
      # ====== 追踪止盈（trailing） ======
      enableTrailingTakeProfit: true         # 是否启用追踪止盈：防止利润回吐
      trailStartCents: 3                     # 达到该利润后开始追踪（分）
      trailDistanceCents: 2                  # 回撤触发距离（分）
    
      # ====== Binance 底层确认（可选） ======
      # 用 Binance 1s 方向做确认（借鉴 momentum bot 的"底层硬动"过滤）
      # 开启后更稳但会降频，要更高频建议关闭
      useBinanceMoveConfirm: false           # 是否启用底层确认
      moveConfirmWindowSeconds: 45           # 回看窗口（秒）
      minUnderlyingMoveBps: 20               # 最小底层波动（bps，1bp=0.01%）
    
      # ====== 库存偏斜保护 ======
      # 当净持仓超过阈值时，降低该方向的交易频率
      inventoryThreshold: 0                 # 净持仓阈值（shares）：0=禁用，建议稳定后设置为 30~50
 
# ===== 系统级 =====
minOrderSize: 1.1
minShareSize: 5.0
 
log_level: "debug"
log_file: "logs/bot.log"
log_by_cycle: true
 
# 实盘交易开关（⚠️ 实盘前必须改为 false）
# 建议：先用 dry_run: true 测试，确认逻辑和日志 OK 再改 false
dry_run: true  # ⚠️ 实盘模式：已启用真实交易
 

order_status_check_timeout: 3
order_status_check_interval: 3
order_status_sync_interval_with_orders: 3
order_status_sync_interval_without_orders: 30