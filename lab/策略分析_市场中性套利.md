# Polymarket BTC 15分钟 Up/Down 市场中性套利策略分析

## 一、策略核心原理

### 1.1 盈利机制

这是一个**市场中性套利策略**，核心思想是：

**当 UP的ask价格 + DOWN的ask价格 < 1.0 时，同时买入两者可以锁定利润**

#### 数学证明：
```
假设：
- UP ask价格 = P_up
- DOWN ask价格 = P_down
- 总成本 = P_up + P_down

结算时：
- 如果UP胜出：UP=1.0, DOWN=0.0，收益 = 1.0 - (P_up + P_down)
- 如果DOWN胜出：UP=0.0, DOWN=1.0，收益 = 1.0 - (P_up + P_down)

结论：只要 P_up + P_down < 1.0，无论哪方胜出都能盈利！
```

#### 实际例子（从CSV数据）：
```
时间 00:00:18: UP=0.48, DOWN=0.55
总成本 = 0.48 + 0.55 = 1.03 (此时不满足条件)

时间 00:01:04: UP=0.45, DOWN=0.44  
总成本 = 0.45 + 0.44 = 0.89 ✅ 套利机会！
买入后：无论哪方胜出，都能获得 1.0 - 0.89 = 0.11 的利润
```

### 1.2 策略特点

根据你的观察和数据分析：

1. **只关心盘口价格**：不依赖BTC实时价格，只关注UP/DOWN的ask/bid
2. **只买不卖**：在整个15分钟内持续买入，持有到结算
3. **持仓管理**：通过持续买入来平衡UP/DOWN持仓，避免单边风险
4. **市场中性**：无论市场方向如何，都能盈利

## 二、策略实现逻辑

### 2.1 核心决策流程

```
每个Tick执行：
1. 获取当前UP和DOWN的ask价格
2. 计算总成本：total_cost = ask_up + ask_down
3. 判断套利机会：
   - 如果 total_cost < 1.0 - threshold（例如0.98）：
     → 计算需要买入的数量，保持UP/DOWN持仓平衡
     → 执行买入
4. 持仓管理：
   - 监控净持仓（UP持仓 - DOWN持仓）
   - 如果净持仓过大，优先买入较少的一方
```

### 2.2 持仓平衡策略

从CSV数据可以看出，机器人会：
- 在价格低时大量买入（如UP=0.20-0.30时买入大量UP）
- 在价格高时买入反向（如DOWN=0.70-0.80时买入DOWN）
- 保持UP和DOWN持仓相对平衡

**持仓平衡公式**：
```
目标持仓比例：UP持仓 : DOWN持仓 ≈ 1:1
允许偏差：±20%（例如：UP=60, DOWN=40 仍然平衡）

当净持仓 = UP - DOWN > 阈值时：
  → 优先买入DOWN
当净持仓 = UP - DOWN < -阈值时：
  → 优先买入UP
```

### 2.3 价格阈值设置

根据数据分析，套利机会通常出现在：
- **最佳机会**：total_cost < 0.90（10%+利润空间）
- **良好机会**：total_cost < 0.95（5%+利润空间）
- **一般机会**：total_cost < 0.98（2%+利润空间）

## 三、策略实现方案

### 3.1 伪代码

```python
class MarketNeutralArbitrageStrategy:
    def __init__(self):
        self.up_position = 0      # UP持仓数量
        self.down_position = 0   # DOWN持仓数量
        self.total_cost = 0      # 总成本
        self.max_imbalance = 0.2 # 最大持仓不平衡比例（20%）
        self.min_profit_threshold = 0.02  # 最小利润阈值（2%）
    
    def on_tick(self, up_ask, down_ask, up_bid, down_bid):
        # 1. 计算套利机会
        total_cost = up_ask + down_ask
        profit_margin = 1.0 - total_cost
        
        if profit_margin < self.min_profit_threshold:
            return  # 没有套利机会
        
        # 2. 计算当前持仓不平衡度
        total_position = self.up_position + self.down_position
        if total_position > 0:
            up_ratio = self.up_position / total_position
            down_ratio = self.down_position / total_position
            imbalance = abs(up_ratio - down_ratio)
        else:
            imbalance = 0
        
        # 3. 决定买入方向
        if imbalance > self.max_imbalance:
            # 持仓不平衡，优先买入较少的一方
            if self.up_position < self.down_position:
                self.buy_up(up_ask)
            else:
                self.buy_down(down_ask)
        else:
            # 持仓平衡，根据价格优势买入
            if up_ask < down_ask:
                self.buy_up(up_ask)
            else:
                self.buy_down(down_ask)
    
    def buy_up(self, price, size=10):
        cost = price * size
        self.up_position += size
        self.total_cost += cost
        # 执行买入订单
    
    def buy_down(self, price, size=10):
        cost = price * size
        self.down_position += size
        self.total_cost += cost
        # 执行买入订单
    
    def calculate_profit(self):
        # 计算当前持仓的预期利润
        # 无论UP还是DOWN胜出，利润都是：
        min_position = min(self.up_position, self.down_position)
        return min_position * 1.0 - self.total_cost
```

### 3.2 关键参数

```yaml
strategy:
  name: market_neutral_arbitrage
  
  # 套利阈值
  min_profit_threshold: 0.02      # 最小利润空间2%
  max_total_cost: 0.98           # 最大总成本（超过则不买入）
  
  # 持仓管理
  max_imbalance_ratio: 0.2        # 最大持仓不平衡比例20%
  target_position_ratio: 0.5      # 目标UP/DOWN持仓比例50:50
  
  # 订单大小
  base_order_size: 10             # 基础订单大小
  max_order_size: 50             # 最大单笔订单
  min_order_size: 1              # 最小订单大小（满足交易所要求）
  
  # 风险控制
  max_total_position: 1000        # 最大总持仓
  max_single_side_position: 600  # 单边最大持仓
```

## 四、策略优势与风险

### 4.1 优势

1. **市场中性**：不依赖BTC价格方向，无论涨跌都能盈利
2. **风险可控**：通过持仓平衡降低单边风险
3. **简单有效**：逻辑清晰，易于实现和维护
4. **持续盈利**：只要市场存在价差，就能持续套利

### 4.2 风险

1. **流动性风险**：如果市场深度不足，可能无法及时成交
2. **滑点风险**：大单可能影响价格，降低实际利润
3. **资金占用**：需要足够的资金来维持双边持仓
4. **市场效率**：随着套利者增多，套利机会可能减少

### 4.3 风险控制措施

1. **持仓限制**：设置最大持仓，避免过度暴露
2. **价格监控**：实时监控价格变化，及时调整策略
3. **资金管理**：预留足够的资金缓冲
4. **止损机制**：如果持仓成本过高，考虑止损

## 五、实施建议

### 5.1 开发步骤

1. **第一阶段：基础实现**
   - 实现核心套利逻辑
   - 实现持仓管理
   - 实现订单执行

2. **第二阶段：优化**
   - 优化订单大小计算
   - 优化持仓平衡算法
   - 添加风险控制

3. **第三阶段：回测验证**
   - 使用历史数据回测
   - 优化参数设置
   - 验证策略有效性

### 5.2 监控指标

- **持仓比例**：UP/DOWN持仓比例
- **总成本**：累计买入成本
- **预期利润**：当前持仓的预期利润
- **套利机会频率**：出现套利机会的次数
- **成交率**：订单成交比例

## 六、参考数据

从 `bot_v0_8_cycle_1765382400.csv` 分析：

- **总交易次数**：654笔
- **UP买入**：约350笔
- **DOWN买入**：约304笔
- **价格范围**：
  - UP: 0.20 - 0.94
  - DOWN: 0.03 - 0.78
- **典型套利机会**：UP=0.48 + DOWN=0.50 = 0.98（2%利润空间）

## 七、总结

这是一个**简单而有效**的市场中性套利策略，核心是：
1. 识别UP+DOWN总成本<1.0的机会
2. 持续买入，保持持仓平衡
3. 持有到结算，无论哪方胜出都能盈利

关键成功因素：
- **快速执行**：及时捕捉套利机会
- **持仓管理**：保持UP/DOWN平衡
- **风险控制**：设置合理的持仓和成本限制
