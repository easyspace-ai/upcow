# prepare-data 工具说明

## 工具定位

`prepare-data` 是一个**可选的**预加载工具，用于提前准备市场数据。

## 是否必须运行？

### ❌ 不是必须的

主程序已经实现了**自动预加载机制**，即使不运行这个工具，程序也能正常工作：

1. **启动时**：后台预加载会立即执行一次，自动拉取未来 100 个周期的市场数据
2. **运行中**：每 5 分钟自动检查并补充缺失的市场数据
3. **自适应**：当获取到未来市场时，自动触发预加载

### ✅ 但建议运行

运行 `prepare-data` 工具有以下优势：

#### 1. 启动时立即有数据
- **有预加载文件**：启动时立即加载 100 个周期到内存（< 100ms）
- **无预加载文件**：需要等待后台预加载（可能需要几分钟）

#### 2. 减少启动后的 API 调用
- **有预加载文件**：启动后几乎不需要 API 调用（数据已在缓存）
- **无预加载文件**：启动后需要调用 API 获取数据（100 个周期 × 100ms = 10 秒）

#### 3. 提供备用数据源
- **API 失败时**：如果预加载文件存在，仍可使用缓存数据
- **网络问题**：不影响已缓存的市场数据访问

## 使用场景

### 场景 1: 生产环境（推荐运行）

```bash
# 定期运行（比如每天一次）
go run cmd/prepare-data/main.go

# 然后启动主程序
go run cmd/bot/main.go
```

**优势**：
- 启动时立即有数据，无需等待
- 减少 API 调用，提高稳定性
- 提供备用数据源

### 场景 2: 开发/测试环境（可选）

```bash
# 直接启动，不运行 prepare-data
go run cmd/bot/main.go
```

**说明**：
- 程序会自动拉取数据
- 可能需要等待几分钟让后台预加载完成
- 适合快速测试

### 场景 3: 首次部署（推荐运行）

```bash
# 首次部署时运行一次
go run cmd/prepare-data/main.go

# 之后可以设置定时任务定期更新
# 或者依赖主程序的自动预加载机制
```

## 工作流程对比

### 有预加载文件

```
启动 → 加载预加载文件（< 100ms）→ 立即有 100 个周期数据 ✅
   ↓
后台预加载检查 → 数据已存在 → 无需 API 调用 ✅
   ↓
所有市场数据从缓存读取（< 1 微秒）✅
```

### 无预加载文件

```
启动 → 预加载文件不存在 → 使用 API 获取
   ↓
后台预加载立即执行 → 开始拉取未来 100 个周期
   ↓
需要等待几分钟（100 个周期 × 100ms = 10 秒）
   ↓
数据拉取完成后，从缓存读取（< 1 微秒）✅
```

## 性能对比

| 场景 | 启动延迟 | API 调用 | 数据可用性 |
|------|----------|----------|------------|
| **有预加载文件** | < 100ms | 几乎为 0 | 立即可用 ✅ |
| **无预加载文件** | 0ms | 100+ 次 | 需等待几分钟 ⏳ |

## 建议

### 生产环境
- ✅ **推荐运行**：定期运行（每天一次或每周一次）
- 可以设置定时任务自动更新

### 开发/测试环境
- ⚠️ **可选**：根据需求决定
- 快速测试时可以不运行

### 首次部署
- ✅ **推荐运行**：首次部署时运行一次
- 之后可以依赖主程序的自动预加载机制

## 总结

- **不是必须的**：主程序会自动拉取数据
- **但建议运行**：可以提升启动速度和稳定性
- **最佳实践**：生产环境定期运行，开发环境可选

## 更新频率

建议的更新频率：
- **生产环境**：每天一次或每周一次
- **开发环境**：按需运行

或者完全依赖主程序的自动预加载机制，无需手动运行。

